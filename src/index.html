<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Endless Chronicle</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="game-container">
        <!-- タイトル画面 -->
        <div id="title-screen" class="screen">
            <h1>Endless Chronicle</h1>
            <button id="start-new-game">ゲーム開始</button>
            <button id="open-load-screen">続きから</button>
        </div>

        <!-- キャラクター作成画面 -->
        <div id="character-creation-screen" class="screen hidden">
            <h2 id="character-creation-title">キャラクター作成</h2>
            <input type="text" id="char-name" placeholder="名前を入力">
            <select id="char-job">
                <option value="戦士">戦士</option>
                <option value="魔法使い">魔法使い</option>
                <option value="僧侶">僧侶</option>
                <option value="盗賊">盗賊</option>
                <option value="狩人">狩人</option>
            </select>
            <button id="create-character-btn">作成</button>
            <button id="cancel-creation-btn" class="hidden">キャンセル</button>
        </div>

        <!-- Gacha Recruit Screen -->
        <div id="gacha-recruit-screen" class="screen hidden">
            <h2>新しい仲間</h2>
            <div id="gacha-result-display" class="character-card" style="margin-bottom: 20px;">
                <!-- Character details will be populated here by JS -->
            </div>
            <div id="gacha-recruit-buttons">
                <button id="accept-recruit-btn">この仲間を迎える</button>
                <button id="reroll-recruit-btn">別の候補を探す</button>
            </div>
            <div id="gacha-name-input-section" class="hidden" style="margin-top: 20px;">
                <input type="text" id="gacha-char-name" placeholder="名前を入力">
                <button id="confirm-recruit-name-btn">決定</button>
            </div>
            <button id="back-to-party-from-gacha" style="margin-top: 20px;">パーティ編成へ戻る</button>
        </div>

        <!-- 拠点画面 -->
        <div id="hub-screen" class="screen hidden">
            <h2>拠点</h2>
            <div id="party-status-hub"></div>
            <div id="expedition-status-container"></div>
            <div class="hub-menu">
                <button id="go-to-dungeon-btn">ダンジョンへ</button>
                <button id="go-to-party-management-btn">パーティ編成</button>
                <button id="go-to-shop-btn">ショップ</button>
                <button id="go-to-temple-btn">転職神殿</button>
                <button id="go-to-reincarnation-btn">転生の祭壇</button>
                <button id="open-save-screen">セーブ</button>
                <button id="go-to-emblems-btn">紋章一覧</button>
                <button id="go-to-help-btn">ヘルプ</button>
            </div>
             <div id="hub-log" class="log-window"></div>
        </div>

        <!-- Emblem Screen -->
        <div id="emblem-screen" class="screen hidden">
            <h2>紋章一覧</h2>
            <div id="emblem-list" class="item-list">
                <!-- Emblems will be populated here by JS -->
            </div>
            <button class="back-to-hub">拠点へ戻る</button>
        </div>

        <!-- ショップ画面 -->
        <div id="shop-screen" class="screen hidden">
            <h2>ショップ</h2>
            <div id="player-gold-display">所持ゴールド: <span id="player-gold"></span>G</div>
            <div class="shop-container">
                <div class="shop-panel">
                    <h3>購入する</h3>
                    <div id="shop-buy-list" class="item-list"></div>
                </div>
                <div class="shop-panel">
                    <h3>売却する</h3>
                    <div id="shop-sell-list" class="item-list"></div>
                </div>
            </div>
            <button id="back-to-hub-from-shop" class="back-to-hub">拠点へ戻る</button>
        </div>

        <!-- キャラクターステータス画面 -->
        <div id="character-detail-screen" class="screen hidden">
            <div class="detail-container">
                <div class="detail-left">
                    <div id="char-detail-header"></div>
                    <h3>ステータス</h3>
                    <div id="char-detail-stats"></div>
                    <div id="char-detail-multipliers" class="stat-multipliers"></div>
                    <div id="char-exp-section">
                        <span>経験値</span>
                        <div class="exp-bar-container">
                            <div id="char-detail-exp-fill" class="exp-bar-fill"></div>
                            <span id="char-detail-exp-text" class="exp-bar-text"></span>
                        </div>
                    </div>
                    <h3>装備</h3>
                    <div id="char-detail-equipment"></div>
                </div>
                <div class="detail-right">
                    <div class="inventory-section">
                        <h3>装備品 (クリックで装備)</h3>
                        <div id="char-detail-inventory" class="item-list"></div>
                    </div>
                    <div class="inventory-section">
                        <h3>消費アイテム (クリックで使用)</h3>
                        <div id="char-detail-consumables" class="item-list"></div>
                    </div>
                    <div class="skill-section">
                        <h3>習得済みスキル</h3>
                        <div id="char-detail-owned-skills" class="item-list"></div>
                    </div>
                    <div class="skill-section">
                        <h3>スキル習得 (SP: <span id="skill-points-display"></span>)</h3>
                        <div id="char-detail-skills" class="item-list"></div>
                    </div>
                </div>
            </div>
            <button id="back-to-hub-from-detail">拠点へ戻る</button>
        </div>

        <!-- パーティ編成画面 -->
        <div id="party-management-screen" class="screen hidden">
            <h2>パーティ編成</h2>
            <div class="party-management-container">
                <div class="character-list-area">
                    <h3>戦闘メンバー (最大4人)</h3>
                    <div id="active-party-list" class="character-list"></div>
                </div>
                <div class="character-list-area">
                    <h3>待機メンバー</h3>
                    <div id="reserve-members-list" class="character-list"></div>
                </div>
            </div>
            <div class="hub-menu">
                <button id="recruit-member-btn">新しい仲間を勧誘</button>
                <button class="back-to-hub">拠点へ戻る</button>
            </div>
        </div>

        <!-- ダンジョン選択画面 -->
        <div id="dungeon-select-screen" class="screen hidden">
            <h2>ダンジョン選択</h2>
            <ul id="dungeon-list"></ul>
            <button class="back-to-hub">拠点へ戻る</button>
        </div>

        <!-- バトル画面 -->
        <div id="battle-screen" class="screen hidden">
            <h3 id="dungeon-floor-tracker"></h3>
            <div id="monster-area"></div>
            <div id="battle-log" class="log-window"></div>
            <div id="party-area">
                <div id="party-status-battle"></div>
                <div id="command-container">
                    <div id="command-window">
                        <button data-command="attack">⚔️ こうげき</button>
                        <button data-command="skill">✨ スキル</button>
                        <button data-command="defend">🛡️ ぼうぎょ</button>
                        <button data-command="item">👜 アイテム</button>
                    </div>
                    <div id="skill-window" class="sub-window hidden">
                        <button class="back-to-command">戻る</button>
                    </div>
                    <div id="item-window" class="sub-window hidden">
                        <button class="back-to-command">戻る</button>
                    </div>
                    <div id="target-window" class="sub-window hidden">
                        <p>対象を選択してください</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- リザルト画面 -->
        <div id="result-screen" class="screen hidden">
            <h2>リザルト</h2>
            <div id="dungeon-clear-message" class="hidden"></div>
            <div id="result-text"></div>
            <div id="result-exp-bars"></div>
            <button id="next-battle-btn">次の戦闘へ</button>
            <button class="back-to-hub">拠点へ戻る</button>
        </div>

        <!-- 転職画面 -->
        <div id="temple-screen" class="screen hidden">
            <h2>転職神殿</h2>
            <p>転職するキャラクターを選択してください (Lv.30以上)。</p>
            <div id="job-change-character-select" class="character-select-list"></div>
            <div id="job-change-options" class="hidden">
                 <p id="job-change-info"></p>
                 <select id="new-job-select"></select>
                 <button id="execute-job-change-btn">転職する</button>
                 <button id="cancel-job-change-btn" class="cancel-btn">やめる</button>
            </div>
            <button class="back-to-hub">拠点へ戻る</button>
        </div>

        <!-- 転生画面 -->
        <div id="reincarnation-screen" class="screen hidden">
            <h2>転生の祭壇</h2>
            <p>転生するキャラクターを選択してください (Lv.99)。</p>
            <div id="reincarnation-character-select" class="character-select-list"></div>
            <div id="reincarnation-options" class="hidden">
                <p id="reincarnation-info"></p>
                <div id="reincarnation-point-allocator"></div>
                <button id="execute-reincarnation-btn">転生する</button>
                <button id="cancel-reincarnation-btn" class="cancel-btn">やめる</button>
            </div>
             <button class="back-to-hub">拠点へ戻る</button>
        </div>

        <!-- データ管理画面 -->
        <div id="save-load-screen" class="screen hidden">
            <h2 id="save-load-title">データ管理</h2>
            <div id="save-slots-list" class="save-slots-container">
                <!-- Save slots will be dynamically inserted here -->
            </div>
            <div class="hub-menu">
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
                <button id="import-game-btn">インポート</button>
                <button id="back-from-save-load-screen">戻る</button>
            </div>
        </div>

        <!-- ヘルプ画面 -->
        <div id="help-screen" class="screen hidden">
            <h2>ヘルプ</h2>
            <div class="help-content">
                <h3>属性について</h3>
                <p>特定のスキルやモンスターは属性を持っています。属性の相性によってダメージが増減します。</p>
                <ul>
                    <li><strong class="log-critical">弱点: ダメージ 1.5倍</strong></li>
                    <li><strong class="log-resist">耐性: ダメージ 0.5倍</strong></li>
                </ul>
                <p>例: 火属性のスキルは、氷属性の弱点を持つモンスターに大ダメージを与えます。</p>

                <h3>状態異常について</h3>
                <p>スキルなどによって、キャラクターが状態異常になることがあります。</p>
                <ul>
                    <li><strong>毒 (☠️):</strong> 自分のターン終了時に最大HPの5%のダメージを受けます。数ターンで自然に治ります。</li>
                    <li><strong>麻痺 (⚡):</strong> 自分のターンの開始時、50%の確率で行動できなくなります。数ターンで自然に治ります。</li>
                    <li><strong>沈黙 (🤫):</strong> 「スキル」コマンドが使えなくなります。数ターンで自然に治ります。</li>
                </ul>

                <h3>種族について</h3>
                <p>キャラクターは種族ごとに異なる特徴（ステータス補正）を持っています。</p>
                <div id="help-race-info">
                    <!-- Race details will be populated here by JS -->
                </div>

                <h3>特性について</h3>
                <p>キャラクターは種族とは別に、個性的な特性を持っていることがあります。</p>
                <div id="help-trait-info">
                    <!-- Trait details will be populated here by JS -->
                </div>

                <h3>ステータスについて</h3>
                <p>各ステータスの意味は以下の通りです。</p>
                <div id="help-stat-info">
                    <!-- Stat details will be populated here by JS -->
                </div>
            </div>
            <button id="back-to-hub-from-help" class="back-to-hub">拠点へ戻る</button>
        </div>
    </div>
    <!-- Data Files -->
    <script src="data/rarities.js"></script>
    <script src="data/races.js"></script>
    <script src="data/traits.js"></script>
    <script src="data/constants.js"></script>
    <script src="data/jobs.js"></script>
    <script src="data/skills.js"></script>
    <script src="data/items.js"></script>
    <script src="data/monsters.js"></script>
    <script src="data/dungeons.js"></script>
    <script src="data/effects.js"></script>
    <script src="data/emblems.js"></script>
    <!-- Main Game Logic -->
    <script src="game.js"></script>
</body>
</html>
